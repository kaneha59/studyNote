vsftpd - (very secure ftp daemon) - 非常安全的ftp守护进程
是一款运行在linux上的一款ftp服务程序

安装vsftpd: yum install vsftpd
安装ftp: yum install ftp  (以命令行界面的方式来管理ftp传输服务的客户端工具)

一.首先看vsftpd的目录结构
    1.根目录: /etc/vsftpd
    2.文件结构:
        ftpusers: 黑名单,写在里边的user无法访问ftp服务.会一直生效.
        user_list: 根据配置不同,可以作为黑名单或白名单使用
        vsftpd.conf: 配置文件
        vsftpd_conf_migrate.sh: vsftpd配置迁徙脚本?不知道是啥

二.简单介绍一下端口
    端口取值范围: 0-65535
    公认端口: 0-1023. 它们紧密绑定（binding）于一些服务。通常这些端口的通讯明确表明了某种服务的协议。例如：80端口实际上总是HTTP通讯。
    注册端口: 1024-49151. 它们松散地绑定于一些服务。也就是说有许多服务绑定于这些端口，这些端口同样用于许多其它目的。例如：许多系统处理动态端口从1024左右开始
    动态和/或私有端口：49152-65535。理论上，不应为服务分配这些端口。***实际上，机器通常从1024起分配动态端口***。但也有例外：SUN的RPC端口从32768开始

    vsftpd监听的端口:
        20: 数据端口,负责数据传输
        21: 命令端口,负责建立连接等

三.FTP的两种传输模式: 主动模式(FTP Port)和被动模式(FTP Passive)
    参考:https://www.cnblogs.com/ajianbeyourself/p/7655464.html
    主动模式流程:
        完全版:
            1.客户端打开两个任意的非特权本地端口(N 和 N+1)
            2.N端口连接服务器的21端口
            3.然后客户端开始监听端口(N+1)，并发送FTP命令“port N+1”到FTP服务器
            4.接着服务器会从它自己的数据端口（20）连接到客户端指定的数据端口（N+1）
        简化版: (->表示建立连接)
            1.客户端N端口 -> 服务器21端口
            2.服务器20端口 -> 客户端N+1端口
        所以防火墙必须允许以下端口的通讯
            FTP服务器命令（21）端口接受客户端任意端口（客户端初始连接）
            FTP服务器命令（21）端口到客户端端口（>1023）（服务器响应客户端命令）
            FTP服务器数据（20）端口到客户端端口（>1023）（服务器初始化数据连接到客户端数据端口）
            FTP服务器数据（20）端口接受客户端端口（>1023）（客户端发送ACK包到服务器的数据端口）

    被动模式流程:
        完全版:
            1.客户端打开两个任意的非特权本地端口(N 和 N+1)
            2.N端口连接服务器的21端口, 并发送PASV命令到服务器
            3.服务器开启任意非特权端口(P)作为数据端口,并发送port P命令给客户端
            4.客户端发起从本地端口N+1到服务器的端口P的连接用来传送数据
        简化版: (->表示建立连接)
            1.客户端N端口 -> 服务器21端口
            2.客户端N+1端口 -> 服务器P端口
        所以防火墙必须允许以下端口的通讯
            FTP服务器命令（21）端口接受客户端任意端口（客户端初始连接）
            FTP服务器命令（21）端口到客户端端口（>1023）（服务器响应客户端命令）
            FTP服务器数据端口（>1023）接受客户端端口（>1023）（客户端初始化数据连接到服务器指定的任意端口）
            FTP服务器数据端口（>1023）到客户端端口（>1023）（服务器发送ACK响应和数据到客户端的数据端口）
    非特权端口: (1024-65535)
    区别: 
        连接方式:
            主动模式: 客户端发送 "port <数据端口>" 命令,服务器连接到客户端的数据端口
            被动模式: 服务器发送 "port <数据端口>" 命令,客户端连接到服务器的数据端口
        使用端口:
            主动模式:20, 21, N, N+1
            被动模式:P,  21, N, N+1  (被动模式中FTP不使用20端口)
        缺点:
            主动模式: FTP服务器企图与客户端的高位随机端口建立连接，而这个端口很有可能被客户端的防火墙阻塞掉
            被动模式: 客户端要与服务器端建立两个连接，其中一个连到一个高位随机端口，而这个端口很有可能被服务器端的防火墙阻塞掉

四.防火墙放开端口
    主动模式: 放开20,21端口
    被动模式: 放开21端口和高位端口

五.如何配置vsftpd
    vim /etc/vsftpd/vsftpd.conf 编辑vsftpd的配置文件

    配置示例:
        #注意: 1.每个变量值后边不能有空格!!!否则会无法启动

        #是否允许匿名登录
        anonymous_enable=NO
        #是否允许本地用户登录FTP,(是否允许本地用户模式, 其他两种模式是 匿名访问模式, 虚拟用户模式)
        local_enable=YES
        write_enable=YES
        local_umask=022

        #指定本地用户的FTP根目录
        local_root=/home/ftp_jinyu59/data
        #将用户权限禁锢在FTP目录
        chroot_local_user=YES
        #允许对FTP根目录执行写入操作
        allow_writeable_chroot=YES
        dirmessage_enable=YES
        xferlog_enable=YES
        connect_from_port_20=YES
        xferlog_std_format=YES

        #是否以独立运行的方式监听服务
        listen=YES
        #设置FTP服务的监控端口
        listen_port=21
        listen_ipv6=NO

        pam_service_name=vsftpd
        #是否启用user_list文件
        userlist_enable=YES
        #设置user_list是白名单还是黑名单(YES为黑名单)
        userlist_deny=NO
        tcp_wrappers=YES

        #设置被动模式下服务器端的数据端口范围
        pasv_min_port=39000
        pasv_max_port=40000

六.vsftpd的3种认证模式
    匿名开放模式
    本地用户模式
    虚拟用户模式
    先不写......

六.使用ftp
    1.确认防火墙启用用到的端口.主动模式(20 和 21),被动模式(21 和 配置文件中规定的端口范围)
    2.确认云服务器的安全组访问规则中的入方向允许 对 (20,21  || 21,被动模式规定范围) 端口的访问
    3.vsftpd配置文件正确配置
    4.登录的用户没有被写入黑名单